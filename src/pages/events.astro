---
import Layout from '~/layouts/PageLayout.astro';
import { fetchPosts } from '~/utils/blog';
import { getLangFromUrl, useTranslations } from '~/i18n/utils';

const locale = getLangFromUrl(Astro.url);
const t = useTranslations(locale);

// âœ… Get posts for current locale
const posts = await fetchPosts(locale);

// âœ… Filter posts by category "events"
const eventPosts = posts.filter(post => post.category === 'events');

const metadata = {
  title: t('nav.events'),
};
---

<Layout metadata={metadata}>

  <h1>{t('nav.events')}</h1>

  <div style="display: flex; flex-wrap: wrap; gap: 2rem; align-items: flex-start;">

    <!-- ðŸ—“ï¸ Luma Calendar -->
    <div style="flex: 1 1 60%;">
      <h2>ðŸŒŒ {t('events.subtitle') ?? 'PrÃ³ximos eventos ACMA'}</h2>
      <iframe 
        src="https://luma.com/embed/calendar/cal-Rm6fnGe9eB88fab/events"
        width="100%" 
        height="800" 
        style="border: none;" 
        frameborder="0" 
        allowfullscreen>
      </iframe>
      <p style="margin-top: 1em;">
        <a href="https://luma.com/acmacolombia?k=c" target="_blank" rel="noopener noreferrer">
          {t('events.link') ?? 'Ver calendario completo en Luma'}
        </a>
      </p>
    </div>

    <!-- ðŸ“ List of blog posts with category "events" -->
    <aside style="flex: 1 1 35%;">
      <h3>{t('events.relatedPosts') ?? 'ArtÃ­culos relacionados'}</h3>
      <ul style="list-style: none; padding: 0; margin: 0;">
        {eventPosts.map(post => (
          <li style="margin-bottom: 1.5rem;">
            <a href={`/${locale}/blog/${post.slug}`} style="text-decoration: none; font-weight: bold;">
              {post.title}
            </a>
            <p style="margin: 0.5rem 0 0; font-size: 0.9rem; color: #666;">{post.excerpt}</p>
          </li>
        ))}
      </ul>
    </aside>

  </div>

</Layout>
