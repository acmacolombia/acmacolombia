---
import Layout from '~/layouts/PageLayout.astro';
import { getLangFromUrl, useTranslations } from '~/i18n/utils';
import BlogLatestPosts from '~/components/widgets/BlogLatestPosts.astro';
import Headline from '~/components/blog/Headline.astro';
import List from '~/components/blog/List.astro';
const locale = getLangFromUrl(Astro.url);
const t = useTranslations(locale);

const metadata = {
  title: t('nav.events'),
};

const postsImport = import.meta.glob('/src/content/post/**/*.md*', { eager: true });
const allPosts = Object.values(postsImport).map((m: any) => ({
  ...((m as any).frontmatter ?? {}),
  url: (m as any).url ?? (m as any).file ?? undefined,
}));

const categoryLabel = locale?.startsWith('es') ? 'eventos' : 'events';

function matchesCategory(post: any) {
  if (!post) return false;
  const cat = post.category ?? post.categories ?? [];
  if (Array.isArray(cat)) return cat.map(c => String(c).toLowerCase()).includes(categoryLabel);
  return String(cat).toLowerCase() === categoryLabel;
}

const eventPosts = allPosts
  .filter(matchesCategory)
  .sort((a, b) => {
    const da = new Date(a.date ?? a.published ?? 0).getTime();
    const db = new Date(b.date ?? b.published ?? 0).getTime();
    return db - da;
  });


export async function getStaticPaths ({ paginate }) {
  return await getStaticPathsBlogTag({ paginate });
}

const { page, tag } = Astro.props;

const currentPage = page.currentPage ?? 1;

const metadata = {
  title: `${tag.replaceAll('-', ' ').replace(/^\w/, c => c.toUpperCase())} ${currentPage > 1 ? ` — ${eventos} ${currentPage} ` : ''}`,
  robots: {
    index: blogTagRobots?.index,
    follow: blogTagRobots?.follow,
  },
};
---




---

<Layout metadata={metadata}>

  
  <section style="max-width:1200px;margin:0 auto;padding:1rem;">
    <Headline><span class="capitalize">Eventos</span></Headline>

    <center><p style="font-size:1.1rem;color:var(--color-muted);">Consulta aquí nuestro calendario actualizado de eventos, talleres, charlas y más.</p></center>
    <!-- Luma Calendar -->
      <iframe 
        src="https://luma.com/embed/calendar/cal-Rm6fnGe9eB88fab/events" 
        width="100%" 
        height="800" 
        style="border: none; overflow: hidden; border-radius:6px;" 
        frameborder="0" 
        allowfullscreen>
      </iframe>
      <p style="margin-top: 1em;text-align:center;">
        <a href="https://luma.com/acmacolombia?k=c" target="_blank" rel="noopener noreferrer">
          Si no puedes ver el calendario, haz clic aquí.
        </a>
      </p>

    <BlogList posts={page.data.map(p => p.locales[locale])} />
    <Pagination prevUrl={page.url.prev} nextUrl={page.url.next} />
  </section>
</Layout>

