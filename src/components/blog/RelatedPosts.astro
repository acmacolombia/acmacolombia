---
import { APP_BLOG } from "~/utils/config";

import { fetchPosts, getRelatedPosts } from "~/utils/blog";
import BlogHighlightedPosts from "../widgets/BlogHighlightedPosts.astro";
import type { Post } from "~/types";
import { getBlogPermalink } from "~/utils/permalinks";
import { getLangFromUrl, useTranslations } from '~/i18n/utils';

const activeLanguage = getLangFromUrl(Astro.url);
const t = useTranslations(activeLanguage);

export interface Props {
  post: Post;
}

const { post } = Astro.props;
const fetchedPosts = await fetchPosts();
const relatedPosts = post.tags ? getRelatedPosts(fetchedPosts, post.slug, post.tags) : [];
---

{
  APP_BLOG.isRelatedPostsEnabled ? (
    <BlogHighlightedPosts
      classes={{ container: "pt-0 lg:pt-0 md:pt-0" }}
      title={t('blog.relatedPosts')}	
      linkText={t('blog.readMore')}
      linkUrl={getBlogPermalink(activeLanguage)}
      postIds={relatedPosts.map((post) => post.id)}
    />
  ) : null
}
